
<%
require "appengine-apis/logger"
require "appengine-apis/memcache"

def get_entry_url(url)
  return url.sub(/^http:\/\//, "http://b.hatena.ne.jp/entry/")
end

  logger = AppEngine::Logger.new

  url = "http://mainichi.jp/area/osaka/news/20100121ddlk27040388000c.html"

  entry_url = get_entry_url(url)
logger.warn(entry_url)
  response = AppEngine::URLFetch.fetch(entry_url, :deadline => 10)

  doc  = Hpricot.parse(response.body)
  div  = doc.at("#entryinfo-body")
  link = div.at("a.location-link") if div
  pref = link.inner_text if link

memcache = AppEngine::Memcache.new
#memcache["test"] = "hoge"
#memcache.delete("test")

%>

<%=h pref %>

<%=h memcache["test"].inspect %>
